<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phi·∫øu ƒê·ªÅ Ngh·ªã Y√™u C·∫ßu</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Times New Roman', serif;
            font-size: 14px;
            line-height: 1.5;
            color: #000;
            background: #f5f5f5;
            padding: 10px;
        }

        /* Container A4 ch√≠nh x√°c */
        .a4-page {
            width: 210mm;
            height: 297mm;
            margin: 0 auto;
            background: white;
            padding: 20mm;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        /* Header c√¥ng ty */
        .company-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .company-name {
            font-size: 16px;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .company-address {
            font-size: 12px;
            color: #666;
            margin-bottom: 15px;
        }

        /* Ti√™u ƒë·ªÅ ch√≠nh */
        .main-title {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #000;
            padding-bottom: 10px;
        }

        .main-title h1 {
            font-size: 20px;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .main-title h2 {
            font-size: 14px;
            font-style: italic;
            color: #333;
        }

        /* S·ªë phi·∫øu */
        .form-number {
            position: absolute;
            top: 20mm;
            right: 20mm;
            text-align: right;
            font-size: 12px;
        }

        .form-number .number {
            font-weight: bold;
            font-size: 14px;
            color: #c0392b;
        }

        /* Th√¥ng tin form */
        .form-section {
            margin-bottom: 15px;
        }

        .section-title {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 8px;
            color: #000;
            border-left: 4px solid #3498db;
            padding-left: 8px;
            background: #ecf0f1;
            padding: 5px 8px;
        }

        /* Grid th√¥ng tin */
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .info-field {
            display: flex;
            align-items: baseline;
            margin-bottom: 10px;
        }

        .field-label {
            font-weight: bold;
            min-width: 120px;
            margin-right: 10px;
        }

        .field-value {
            flex: 1;
            border-bottom: 1px dotted #666;
            min-height: 20px;
            padding: 0 5px;
        }

        /* Full width fields */
        .full-width-field {
            grid-column: 1 / -1;
        }

        /* Text areas */
        .text-area {
            border: 1px solid #666;
            padding: 10px;
            background: #fafafa;
            font-family: 'Times New Roman', serif;
            font-size: 13px;
            line-height: 1.4;
        }

        .description-area {
            min-height: 60mm;
        }

        .solution-area {
            min-height: 45mm;
        }

        /* B·∫£ng th√¥ng s·ªë k·ªπ thu·∫≠t */
        .tech-specs {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
            font-size: 13px;
        }

        .tech-specs th,
        .tech-specs td {
            border: 1px solid #666;
            padding: 8px;
            text-align: left;
        }

        .tech-specs th {
            background: #f8f9fa;
            font-weight: bold;
        }

        /* Approval section */
        .approval-section {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #ccc;
        }

        .approval-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 25px;
            margin-top: 15px;
        }

        .approval-box {
            text-align: center;
            padding: 10px;
            border: 1px dashed #999;
            background: #fefefe;
        }

        .approval-title {
            font-weight: bold;
            margin-bottom: 40px;
            font-size: 13px;
        }

        .signature-line {
            border-bottom: 1px solid #000;
            margin-bottom: 5px;
            height: 1px;
        }

        .approval-note {
            font-size: 11px;
            color: #666;
            font-style: italic;
        }

        /* Controls */
        .controls {
            position: fixed;
            top: 15px;
            right: 15px;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            z-index: 1000;
        }

        .control-btn {
            padding: 8px 15px;
            margin: 0 3px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn-print {
            background: #007bff;
            color: white;
        }

        .btn-print:hover {
            background: #0056b3;
        }

        .btn-pdf {
            background: #28a745;
            color: white;
        }

        .btn-pdf:hover {
            background: #1e7e34;
        }

        /* Print styles */
        @media print {
            body {
                background: white;
                padding: 0;
            }

            .controls {
                display: none;
            }

            .a4-page {
                width: 100%;
                height: 100vh;
                margin: 0;
                padding: 15mm;
                box-shadow: none;
            }

            @page {
                size: A4 portrait;
                margin: 0;
            }

            .form-section {
                page-break-inside: avoid;
            }
        }

        /* Responsive */
        @media screen and (max-width: 768px) {
            .a4-page {
                width: 100%;
                height: auto;
                padding: 15px;
            }

            .info-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .approval-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .controls {
                position: static;
                margin-bottom: 15px;
                text-align: center;
            }
        }

        /* Priority badges */
        .priority-high {
            background: #e74c3c;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: bold;
        }

        .priority-normal {
            background: #f39c12;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="controls">
        <button class="control-btn btn-print" onclick="printForm()">üñ®Ô∏è In Phi·∫øu</button>
        <button class="control-btn btn-pdf" onclick="exportPDF()">üìÑ Xu·∫•t PDF</button>
    </div>

    <div class="a4-page" id="requestForm">
        <div class="form-number">
            <div>S·ªë: <span class="number" id="formNumber"></span></div>
            <div id="currentDate"></div>
        </div>

        <div class="company-header">
            <div class="company-name">C√îNG TY C·ªî PH·∫®N ƒêI·ªÜN N∆Ø·ªöC AN GIANG</div>
            <div class="company-address">ƒê·ªãa ch·ªâ: 123 ƒê∆∞·ªùng ABC, Qu·∫≠n XYZ, TP. H·ªì Ch√≠ Minh | ƒêT: (028) 1234-5678</div>
        </div>

        <div class="main-title">
            <h1>PHI·∫æU ƒê·ªÄ NGH·ªä Y√äU C·∫¶U</h1>
            <h2>X·ª≠ l√Ω s·ª± c·ªë h·ªá th·ªëng ƒë∆∞·ªùng ·ªëng</h2>
        </div>

        <!-- Th√¥ng tin c∆° b·∫£n -->
        <div class="form-section">
            <div class="section-title">I. TH√îNG TIN S·ª∞ C·ªê</div>
            <div class="info-grid">
                <div class="info-field">
                    <div class="field-label">Ng√†y x·∫£y ra:</div>
                    <div class="field-value" id="incidentDate"></div>
                </div>
                <div class="info-field">
                    <div class="field-label">M·ª©c ƒë·ªô:</div>
                    <div class="field-value">
                        <span class="priority-high" id="priorityBadge">KH·∫®N C·∫§P</span>
                    </div>
                </div>
                <div class="info-field">
                    <div class="field-label">Ph√¢n lo·∫°i:</div>
                    <div class="field-value" id="incidentType"></div>
                </div>
                <div class="info-field">
                    <div class="field-label">M√£ s·ª± c·ªë:</div>
                    <div class="field-value" id="incidentCode"></div>
                </div>
                <div class="info-field full-width-field">
                    <div class="field-label">V·ªã tr√≠ x·∫£y ra:</div>
                    <div class="field-value" id="location"></div>
                </div>
            </div>
        </div>

        <!-- Th√¥ng s·ªë k·ªπ thu·∫≠t -->
        <div class="form-section">
            <div class="section-title">II. TH√îNG S·ªê K·ª∏ THU·∫¨T</div>
            <table class="tech-specs">
                <tr>
                    <th style="width: 25%">Lo·∫°i ƒë∆∞·ªùng ·ªëng</th>
                    <th style="width: 25%">ƒê∆∞·ªùng k√≠nh</th>
                    <th style="width: 25%">√Åp l·ª±c v·∫≠n h√†nh</th>
                    <th style="width: 25%">NƒÉm l·∫Øp ƒë·∫∑t</th>
                </tr>
                <tr>
                    <td id="pipeType"></td>
                    <td id="pipeDiameter"></td>
                    <td id="pressure">3.5 - 4.0 bar</td>
                    <td id="installYear">2018</td>
                </tr>
            </table>
        </div>

        <!-- M√¥ t·∫£ chi ti·∫øt -->
        <div class="form-section">
            <div class="section-title">III. M√î T·∫¢ CHI TI·∫æT S·ª∞ C·ªê</div>
            <div class="text-area description-area" id="description"></div>
        </div>

        <!-- ƒê·ªÅ xu·∫•t gi·∫£i ph√°p -->
        <div class="form-section">
            <div class="section-title">IV. ƒê·ªÄ XU·∫§T BI·ªÜN PH√ÅP X·ª¨ L√ù</div>
            <div class="text-area solution-area" id="measures"></div>
        </div>

        <!-- Ph·∫ßn ph√™ duy·ªát -->
        <div class="approval-section">
            <div class="section-title">V. PH√ä DUY·ªÜT TH·ª∞C HI·ªÜN</div>
            <div class="approval-grid">
                <div class="approval-box">
                    <div class="approval-title">NG∆Ø·ªúI ƒê·ªÄ NGH·ªä</div>
                    <div class="signature-line"></div>
                    <div class="approval-note">(K√Ω t√™n, ghi r√µ ch·ª©c v·ª•)</div>
                </div>
                <div class="approval-box">
                    <div class="approval-title">TR∆Ø·ªûNG PH√íNG K·ª∏ THU·∫¨T</div>
                    <div class="signature-line"></div>
                    <div class="approval-note">(K√Ω t√™n, ƒë√≥ng d·∫•u)</div>
                </div>
                <div class="approval-box">
                    <div class="approval-title">GI√ÅM ƒê·ªêC</div>
                    <div class="signature-line"></div>
                    <div class="approval-note">(K√Ω t√™n, ƒë√≥ng d·∫•u)</div>
                </div>
            </div>
            <div style="margin-top: 15px; font-size: 12px; color: #666;">
                <strong>Ghi ch√∫:</strong> Phi·∫øu n√†y c√≥ hi·ªáu l·ª±c sau khi ƒë∆∞·ª£c Gi√°m ƒë·ªëc k√Ω duy·ªát v√† ph·∫£i ƒë∆∞·ª£c th·ª±c hi·ªán trong v√≤ng 24 gi·ªù.
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script>
        // L·∫•y d·ªØ li·ªáu t·ª´ URL
        function getFormData() {
            const params = new URLSearchParams(window.location.search);
            return {
                incidentDate: params.get('ngay') || getCurrentDate(),
                location: params.get('vitri') || '',
                incidentType: params.get('phanloai') || '',
                pipeType: params.get('loaiong') || '',
                pipeDiameter: params.get('duongkinh') || '',
                description: params.get('mota') || '',
                measures: params.get('bienphap') || ''
            };
        }

        // L·∫•y ng√†y hi·ªán t·∫°i
        function getCurrentDate() {
            const now = new Date();
            const day = now.getDate().toString().padStart(2, '0');
            const month = (now.getMonth() + 1).toString().padStart(2, '0');
            const year = now.getFullYear();
            return `${day}/${month}/${year}`;
        }

        // T·∫°o s·ªë phi·∫øu
        function generateFormNumber() {
            const now = new Date();
            const year = now.getFullYear();
            const month = (now.getMonth() + 1).toString().padStart(2, '0');
            const day = now.getDate().toString().padStart(2, '0');
            const sequence = Math.floor(Math.random() * 999) + 1;
            return `${sequence.toString().padStart(3, '0')}/ƒêNXL-${day}${month}${year}`;
        }

        // T·∫°o m√£ s·ª± c·ªë
        function generateIncidentCode() {
            const types = ['SC', 'RL', 'TC', 'BH', 'KT'];
            const type = types[Math.floor(Math.random() * types.length)];
            const number = Math.floor(Math.random() * 9999) + 1;
            return `${type}-${number.toString().padStart(4, '0')}`;
        }

        // X√°c ƒë·ªãnh m·ª©c ƒë·ªô ∆∞u ti√™n
        function getPriority(incidentType) {
            const highPriority = ['r√≤ r·ªâ nghi√™m tr·ªçng', 'v·ª° ·ªëng', 'm·∫•t √°p l·ª±c', 'ng·∫≠p √∫ng'];
            const type = incidentType.toLowerCase();
            
            for (let priority of highPriority) {
                if (type.includes(priority)) {
                    return { text: 'KH·∫®N C·∫§P', class: 'priority-high' };
                }
            }
            return { text: 'B√åNH TH∆Ø·ªúNG', class: 'priority-normal' };
        }

        // ƒêi·ªÅn d·ªØ li·ªáu v√†o form
        function populateForm() {
            const data = getFormData();
            const now = new Date();
            
            // Th√¥ng tin c∆° b·∫£n
            document.getElementById('formNumber').textContent = generateFormNumber();
            document.getElementById('currentDate').textContent = `Ng√†y ${getCurrentDate()}`;
            document.getElementById('incidentDate').textContent = data.incidentDate;
            document.getElementById('location').textContent = data.location;
            document.getElementById('incidentType').textContent = data.incidentType;
            document.getElementById('pipeType').textContent = data.pipeType;
            document.getElementById('pipeDiameter').textContent = data.pipeDiameter;
            document.getElementById('description').textContent = data.description;
            document.getElementById('measures').textContent = data.measures;
            document.getElementById('incidentCode').textContent = generateIncidentCode();
            
            // X·ª≠ l√Ω m·ª©c ƒë·ªô ∆∞u ti√™n
            const priority = getPriority(data.incidentType);
            const priorityBadge = document.getElementById('priorityBadge');
            priorityBadge.textContent = priority.text;
            priorityBadge.className = priority.class;
        }

        // In form
        function printForm() {
            window.print();
        }

        // Xu·∫•t PDF
        function exportPDF() {
            const element = document.getElementById('requestForm');
            const formNum = document.getElementById('formNumber').textContent.replace(/\//g, '-');
            
            const options = {
                margin: 0,
                filename: `Phieu_De_Nghi_${formNum}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: {
                    scale: 2,
                    useCORS: true,
                    letterRendering: true,
                    width: 794,
                    height: 1123
                },
                jsPDF: {
                    unit: 'px',
                    format: [794, 1123],
                    orientation: 'portrait'
                }
            };

            html2pdf().set(options).from(element).save();
        }

        // Kh·ªüi t·∫°o
        document.addEventListener('DOMContentLoaded', populateForm);

        // URL m·∫´u ƒë·ªÉ test:
        // ?ngay=17/08/2024&vitri=S·ªë 456 ƒê∆∞·ªùng V√µ VƒÉn T·∫ßn, Ph∆∞·ªùng 5, Qu·∫≠n 3, TP.HCM&phanloai=R√≤ r·ªâ nghi√™m tr·ªçng&loaiong=Gang d·∫ªo DN400&duongkinh=400mm&mota=Ph√°t hi·ªán v·∫øt n·ª©t l·ªõn tr√™n th√¢n ·ªëng c·∫•p n∆∞·ªõc ch√≠nh t·∫°i ƒë·ªô s√¢u 1.5m, n∆∞·ªõc r√≤ r·ªâ v·ªõi l∆∞u l∆∞·ª£ng kho·∫£ng 50 l√≠t/ph√∫t. Hi·ªán t∆∞·ª£ng n√†y ƒë√£ g√¢y gi·∫£m √°p l·ª±c cung c·∫•p n∆∞·ªõc cho khu v·ª±c r·ªông l·ªõn, ·∫£nh h∆∞·ªüng ƒë·∫øn sinh ho·∫°t c·ªßa kho·∫£ng 2000 h·ªô d√¢n. Nguy√™n nh√¢n s∆° b·ªô do ·ªëng ƒë√£ h·∫øt tu·ªïi th·ªç thi·∫øt k·∫ø v√† t√°c ƒë·ªông t·ª´ c√¥ng tr√¨nh x√¢y d·ª±ng l√¢n c·∫≠n.&bienphap=1. C·∫Øt cung c·∫•p n∆∞·ªõc kh·∫©n c·∫•p cho khu v·ª±c ·∫£nh h∆∞·ªüng v√† th√¥ng b√°o cho ng∆∞·ªùi d√¢n\n2. Huy ƒë·ªông ƒë·ªôi s·ª≠a ch·ªØa kh·∫©n c·∫•p ƒë·∫øn hi·ªán tr∆∞·ªùng ngay l·∫≠p t·ª©c\n3. Ti·∫øn h√†nh ƒë√†o h·ªë ƒë·ªÉ ti·∫øp c·∫≠n v·ªã tr√≠ h∆∞ h·ªèng m·ªôt c√°ch an to√†n\n4. Thay th·∫ø to√†n b·ªô ƒëo·∫°n ·ªëng h∆∞ h·ªèng b·∫±ng ·ªëng HDPE PE100 DN400 m·ªõi\n5. L·∫Øp ƒë·∫∑t th√™m van c·∫Øt ƒë·ªÉ thu·∫≠n ti·ªán b·∫£o d∆∞·ª°ng trong t∆∞∆°ng lai\n6. Ki·ªÉm tra ch·∫•t l∆∞·ª£ng n∆∞·ªõc v√† th·ª≠ √°p sau khi ho√†n th√†nh\n7. Kh√¥i ph·ª•c cung c·∫•p n∆∞·ªõc v√† theo d√µi v·∫≠n h√†nh trong 48 gi·ªù ƒë·∫ßu
    </script>
</body>
</html>
